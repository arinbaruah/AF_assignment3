<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arindom Baruah (32779267)">

<title>ETC 5550 Assignment 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/clipboard/clipboard.min.js"></script>
<script src="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/quarto-html/quarto.js"></script>
<script src="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/quarto-html/popper.min.js"></script>
<script src="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/quarto-html/anchor.min.js"></script>
<link href="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Assignment3_5550_Arindom_32779267.qmdqmd_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ETC 5550 Assignment 3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arindom Baruah (32779267) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="libraries" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Libraries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">32779267</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">"https://bit.ly/monashpopulationdata"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="fu">sample</span>(Country, <span class="dv">1</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>pop <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="sc">%&gt;%</span> <span class="fu">kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-data" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;1: Glimpse of the data</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Code</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa Western and Central</td>
<td style="text-align: left;">AFW</td>
<td style="text-align: right;">1960</td>
<td style="text-align: right;">97256290</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa Western and Central</td>
<td style="text-align: left;">AFW</td>
<td style="text-align: right;">1961</td>
<td style="text-align: right;">99314028</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa Western and Central</td>
<td style="text-align: left;">AFW</td>
<td style="text-align: right;">1962</td>
<td style="text-align: right;">101445032</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa Western and Central</td>
<td style="text-align: left;">AFW</td>
<td style="text-align: right;">1963</td>
<td style="text-align: right;">103667517</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa Western and Central</td>
<td style="text-align: left;">AFW</td>
<td style="text-align: right;">1964</td>
<td style="text-align: right;">105959979</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa Western and Central</td>
<td style="text-align: left;">AFW</td>
<td style="text-align: right;">1965</td>
<td style="text-align: right;">108336203</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p><a href="#tbl-data">Table&nbsp;1</a> illustrates the timeseries data for the country “Africa Western and Central AFW” which shall be analysed in the upcoming sections.</p>
</section>
<section id="exercises" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Exercises</h1>
<section id="sec-initial" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-initial"><span class="header-section-number">3.1</span> Splitting data into train-test data and fitting benchmark models.</h2>
<p>Let us first visualise the population growth for the country “Africa Western and Central AFW”.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pop <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Population growth in Africa Western and Central AFW"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-totpop" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment3_5550_Arindom_32779267.qmdqmd_files/figure-html/fig-totpop-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Population growth in Africa Western and Central AFW</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>As we can observe in <a href="#fig-totpop">Figure&nbsp;1</a>, <strong>the population in Africa and Central AFW has grown at an exponential rate</strong>.</p>
<p>We shall transform our data such that the overall trend of the data is linear. In this regard, <strong>we shall apply a logarithmic transformation of our data.</strong></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pop <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(<span class="fu">log</span>(Population)) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Logarithmic population growth in Africa Western and Central AFW"</span>,<span class="at">y =</span> <span class="st">"Log of population"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-totpoplog" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment3_5550_Arindom_32779267.qmdqmd_files/figure-html/fig-totpoplog-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Logarithim population growth in Africa Western and Central AFW</figcaption>
</figure>
</div>
</div>
</div>
<p>As we can now observe through <a href="#fig-totpoplog">Figure&nbsp;2</a>, <strong>upon performing the logarithmic transformation, we can observe a linear trend in the growth rate.</strong></p>
<p>In the next step, we shall split our data into train and test data. The split is formed on the following basis:</p>
<ul>
<li>Population data for the years <strong>before 2018</strong> will be used as the <strong>train dataset</strong></li>
<li>Population data for the years <strong>2018 - 2022</strong> will be used as the <strong>test dataset</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pop_train <span class="ot">&lt;-</span> pop <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&lt;</span> <span class="dv">2018</span>) <span class="co"># Train dataset</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pop_test <span class="ot">&lt;-</span> pop <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2018</span>) <span class="co"># Test dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert alert-info">
<p>🛠⚙️🔬⛓️</p>
<p>Now that we have transformed our data and split it based on training and testing dataset, we will utilise the benchmark models to forecast the logarithmic population growth. The models which will be used are as follows:</p>
<ul>
<li>ETS (Error Trend Seasonality) model</li>
<li>Naïve model</li>
<li>Mean model</li>
<li>Drift model</li>
</ul>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As our <strong>data does not contain a seasonality component, hence we shall not fit a seasonal naïve benchmark model.</strong></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>model_fit <span class="ot">&lt;-</span> pop_train <span class="sc">%&gt;%</span> <span class="fu">model</span>(<span class="at">ets =</span> <span class="fu">ETS</span>(<span class="fu">log</span>(Population)), <span class="co"># ETS Model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">naive =</span> <span class="fu">NAIVE</span>(<span class="fu">log</span>(Population)), <span class="co"># Naïve model</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mean =</span> <span class="fu">MEAN</span>(<span class="fu">log</span>(Population)), <span class="co"># Mean model</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">drift =</span> <span class="fu">RW</span>(<span class="fu">log</span>(Population) <span class="sc">~</span> <span class="fu">drift</span>())) <span class="co"># Drift model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have fitted our training data on the ETS model and the benchmark models, we will check the peformance of each of these models.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pop_fc <span class="ot">&lt;-</span> model_fit <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>pop_fc <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>(pop) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(RMSE) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ME,MAE,MPE,MAPE,MASE,RMSSE)) <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">"r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">background =</span> <span class="st">"#FFAF33"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"2.5em"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">background =</span> <span class="st">"#FFAF33"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">width =</span> <span class="st">"2.5em"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-accuracy" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;2: Model performance output metrics</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">.model</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">Country</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">.type</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">RMSE</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">ACF1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">drift</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">73304.74</td>
<td style="text-align: right; width: 2.5em;">-0.5</td>
</tr>
<tr class="even">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">ets</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">360711.84</td>
<td style="text-align: right; width: 2.5em;">-0.5</td>
</tr>
<tr class="odd">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">naive</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">18057512.79</td>
<td style="text-align: right; width: 2.5em;">-0.5</td>
</tr>
<tr class="even">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">mean</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">228394880.47</td>
<td style="text-align: right; width: 2.5em;">-0.5</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>As we can observe in <a href="#tbl-accuracy">Table&nbsp;2</a>, the <strong>“Drift method”</strong> is observed to be the model which has forecasted the test dataset with least root mean square error. This is followed by the ETS model, Naïve model and the mean model respectively.</p>
<p><strong>Hence, based on the RMSE values, we can say that the Drift method forecasts the best for the test dataset.</strong></p>
</div>
</div>
</section>
<section id="checking-for-the-residuals-of-the-drift-model" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="checking-for-the-residuals-of-the-drift-model"><span class="header-section-number">3.2</span> Checking for the residuals of the Drift model</h2>
<p>Let us now check how do the residuals look like for the drift model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>model_fit <span class="sc">%&gt;%</span> <span class="fu">select</span>(drift) <span class="sc">%&gt;%</span> <span class="fu">gg_tsresiduals</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Residuals in the drift model"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-residuals" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment3_5550_Arindom_32779267.qmdqmd_files/figure-html/fig-residuals-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Residual diagnosis of the predictions from the drift method</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ljung box test</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(model_fit) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(.resid,ljung_box,<span class="at">lag =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">"r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">background =</span> <span class="st">"#FFAF33"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"2.5em"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">background =</span> <span class="st">"#FFAF33"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">width =</span> <span class="st">"2.5em"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">FALSE</span>) <span class="co"># Lag = 10 chosen due to non-seasonal data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-lb" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;3: Ljung-Box test results with lag=10 for the model residuals</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">Country</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">.model</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">lb_stat</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">lb_pvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">drift</td>
<td style="text-align: right; width: 2.5em;">243.09</td>
<td style="text-align: right; width: 2.5em;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">ets</td>
<td style="text-align: right; width: 2.5em;">23.02</td>
<td style="text-align: right; width: 2.5em;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">mean</td>
<td style="text-align: right; width: 2.5em;">333.19</td>
<td style="text-align: right; width: 2.5em;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">naive</td>
<td style="text-align: right; width: 2.5em;">330.21</td>
<td style="text-align: right; width: 2.5em;">0.00</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on the ACF plot in <a href="#fig-residuals">Figure&nbsp;3</a>, we can observe the following key points:</p>
<ol type="1">
<li><p>The ACF plot illustrates that there is a pattern which we can observe in the residuals of the drift model.</p></li>
<li><p>The pattern in the ACF plot indicates that the <strong>model has missed out on the trend of the data, as a result of which, the ACF values appear to be higher than the significant thresholds</strong> (shown by the <span style="color:blue">blue lines</span>).</p></li>
<li><p>Additionally, we observe that the <strong>residuals of the model fail to form a normal distribution.</strong></p></li>
<li><p>Performing the Ljung-Box test on the residuals as illustrated in <a href="#tbl-lb">Table&nbsp;3</a> indicates that <strong>the drift method has a Ljung-Box P-value (<code>lb_pvalue</code>) of less than 0.05, which further indicates that the model has failed the test and could not effectively produce an accurate forecast of the data.</strong></p></li>
<li><p>Based on the above observations, we can say that the <strong>residuals of the model do not appear to be simple white noise.</strong></p></li>
</ol>
</div>
</div>
<p>Let us try to visualise how do our forecasts look like for the training data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pop_fc <span class="ot">&lt;-</span> model_fit <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">new_data =</span> pop_train)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>model_fit <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"10 years"</span>)  <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>(pop_train) <span class="sc">+</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecasted population in Africa Western and Central AFW"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Logarithmic population"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-model" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment3_5550_Arindom_32779267.qmdqmd_files/figure-html/fig-model-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Forecasts and the confidence intervals for each model</figcaption>
</figure>
</div>
</div>
</div>
<p>As we can observe from <a href="#fig-model">Figure&nbsp;4</a>, <strong>the mean and the naïve models have completely missed the overall trend of the logarithmic population rise</strong> while the <strong>drift and the ETS models appear to follow the overall global trend very closely.</strong></p>
</section>
<section id="sec-final" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-final"><span class="header-section-number">3.3</span> Utilisation of cross-validation and recalculation of RMSE for the models</h2>
<p>In this section, we will attempt to perform cross-validation on our data which will provide us with multiple smaller training data and allow our model to fit better as we will be able to create multiple “5-year” forecasts, thereby providing us with more accuracy. The implementation of cross-validation of our data is delineated below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pop_train <span class="sc">%&gt;%</span> <span class="fu">stretch_tsibble</span>(<span class="at">.init =</span> <span class="dv">15</span>,<span class="at">.step =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">model</span>(<span class="at">ets =</span> <span class="fu">ETS</span>(<span class="fu">log</span>(Population)), <span class="co"># ETS Model</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">naive =</span> <span class="fu">NAIVE</span>(<span class="fu">log</span>(Population)), <span class="co"># Naïve model</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mean =</span> <span class="fu">MEAN</span>(<span class="fu">log</span>(Population)), <span class="co"># Mean model</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">drift =</span> <span class="fu">RW</span>(<span class="fu">log</span>(Population))) <span class="sc">%&gt;%</span> <span class="co"># Drift model</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="sc">%&gt;%</span> <span class="fu">accuracy</span>(pop) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(RMSE) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ME,MAE,MPE,MAPE,MASE,RMSSE)) <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">"r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">background =</span> <span class="st">"#FFAF33"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"2.5em"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">background =</span> <span class="st">"#FFAF33"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">width =</span> <span class="st">"2.5em"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">3</span>, <span class="at">bold =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-cv" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;4: Updated RMSE of each model after performing cross-validation on the test data</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">.model</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">Country</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">.type</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">RMSE</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(255, 175, 51, 255) !important;">ACF1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">ets</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">672720.9</td>
<td style="text-align: right; width: 2.5em;">0.66</td>
</tr>
<tr class="even">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">drift</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">25280713.9</td>
<td style="text-align: right; width: 2.5em;">0.32</td>
</tr>
<tr class="odd">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">naive</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">25280713.9</td>
<td style="text-align: right; width: 2.5em;">0.32</td>
</tr>
<tr class="even">
<td style="text-align: right; width: 2.5em; color: white !important; background-color: rgba(255, 175, 51, 255) !important; width: 2.5em;">mean</td>
<td style="text-align: right; width: 2.5em;">Africa Western and Central</td>
<td style="text-align: right; width: 2.5em;">Test</td>
<td style="text-align: right; width: 2.5em;">133095404.9</td>
<td style="text-align: right; width: 2.5em;">0.96</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>After performing cross-validation of the data and obtaining the model metrics as illustrated by <a href="#tbl-cv">Table&nbsp;4</a>, <strong>we observe that the ETS model is the one that performs the best followed by the drift model.</strong></p>
<p>This indicates that <strong>with the implementation of the cross-validation, the ETS model is observed to train itself better due to the availability of more train/test data and outperform the drift model which was observed to be the best in <a href="#sec-initial">Section&nbsp;3.1</a> .</strong></p>
</div>
</div>
</section>
<section id="reliability-of-each-of-the-methods" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="reliability-of-each-of-the-methods"><span class="header-section-number">3.4</span> Reliability of each of the methods</h2>
<p>The timeseries analysis on the logarithmic population data was performed through two methods:</p>
<ul>
<li><p>The first method as delineated in <a href="#sec-initial">Section&nbsp;3.1</a> created a single “5-year” forecast by using the test dataset to obtain the model performance metric in the form of RMSE.</p></li>
<li><p>The second method as delineated in <a href="#sec-final">Section&nbsp;3.3</a> takes the advantage of creating multiple “5-year” forecasts and testing on each of them to obtain the model performance metric (RMSE). This is done so by making multiple number of smaller training datasets which progressively increase by one observation in each “fold” of the data.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>After assessing both methods as described, it becomes evident that the approach <strong>employing cross-validation to forecast future outcomes and furnish us with model accuracy stands out as the more dependable choice.</strong></p>
<p>This is due to the fact that when we utilise cross-validation, we are creating multiple number of “5-year” forecasts instead of just one and evaluating the model performance based on all these forecasts by obtaining an average metric across all the folds obtained.</p>
<p>As a result of the multiple training sets and the testing sets that are created during the method employing cross-validation, <strong>we obtain a model metric (such as RMSE) which is averaged over all the test sets, thereby providing us with a more accurate and a stable estimate to base our decision on.</strong></p>
</div>
</div>
</section>
</section>
<section id="reference" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Reference</h1>
<ol type="1">
<li><p><strong>fpp3</strong>: Hyndman R (2023). <em>fpp3: Data for “Forecasting: Principles and Practice” (3rd Edition)</em>. R package version 0.5, <a href="https://CRAN.R-project.org/package=fpp3" class="uri">https://CRAN.R-project.org/package=fpp3</a>.</p></li>
<li><p><strong>ggplot2</strong>: H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.</p></li>
<li><p><strong>tidyverse</strong>: Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). “Welcome to the tidyverse.” <em>Journal of Open Source Software</em>, <em>4</em>(43), 1686. doi:10.21105/joss.01686 <a href="https://doi.org/10.21105/joss.01686" class="uri">https://doi.org/10.21105/joss.01686</a>.</p></li>
<li><p><strong>kableExtra</strong>: Zhu H (2024). <em>kableExtra: Construct Complex Table with ‘kable’ and Pipe Syntax</em>. R package version 1.4.0, <a href="https://CRAN.R-project.org/package=kableExtra" class="uri">https://CRAN.R-project.org/package=kableExtra</a>.</p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>